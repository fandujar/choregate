FROM node:22.1-alpine

ENV API_BASE_URL=http://choregate-backend:8080
ENV NODE_ENV=dev
WORKDIR /app


COPY choregate-ui/package.json choregate-ui/package-lock.json ./choregate-ui/

RUN cd choregate-ui && npm install

COPY . .

WORKDIR /app/choregate-ui

EXPOSE 3000

CMD ["npm", "run", "watch"]

HEALTHCHECK --interval=30s --timeout=10s --start-period=5s --retries=3 \
  CMD ["sh", "-c", "[ -f /app/cmd/choregate/index.html ] || exit 1"]
